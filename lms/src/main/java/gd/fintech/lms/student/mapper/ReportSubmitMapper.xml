<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gd.fintech.lms.student.mapper.ReportSubmitMapper">
	<!-- 과제제출의 정보와 과제제출 첨부파일을 위한 resultMap -->
	<resultMap type="gd.fintech.lms.student.vo.ReportSubmit" id="resultReportSubmitDetail">
		<result property="reportNo" column="report_no"/>
		<result property="accountId" column="account_id"/>
		<result property="reportSubmitUpdateDate" column="report_submit_updatedate"/>
		<result property="reportSubmitTitle" column="report_submit_title"/>
		<result property="reportSubmitContent" column="report_submit_content"/>
		<result property="reportSubmitPoint" column="report_submit_point"/>
		<result property="reportSubmitFeedback" column="report_submit_feedback"/>
		<collection property="reportSubmitFileList" ofType="gd.fintech.lms.student.vo.ReportSubmitFile">
			<result property="reportSubmitFileUUID" column="report_submit_file_uuid"/>
			<result property="reportSubmitFileOriginal" column="report_submit_file_original"/>
			<result property="reportSubmitFileSize" column="report_submit_file_size"/>
			<result property="reportSubmitFileType" column="report_submit_file_type"/>
			<result property="reportSubmitFileCount" column="report_submit_file_count"/>
		</collection>
	</resultMap>
	<!-- 과제를 제출한 정보 상세보기 -->
	<select id="selectReportSubmitDetail" resultMap="resultReportSubmitDetail">
		SELECT 
			rs.report_no,
			rs.account_id,
			rs.report_submit_updatedate,
			rs.report_submit_title,
			rs.report_submit_content,
			rs.report_submit_point,
			rs.report_submit_feedback,
			rsf.report_submit_file_uuid,
			rsf.report_submit_file_original,
			rsf.report_submit_file_size,
			rsf.report_submit_file_type,
			rsf.report_submit_file_count
		FROM report_submit rs
		LEFT JOIN report_submit_file rsf
		ON rs.report_submit_no = rsf.report_submit_no
		WHERE rs.report_submit_no = #{report_submit_no}
	</select>
	
	<!-- 과제제출 정보 입력 -->
	<insert id="insertReportSubmit" parameterType="gd.fintech.lms.student.vo.ReportSubmit">
		<selectKey resultType="int" keyProperty="reportSubmitNo" order="AFTER">
	  		SELECT LAST_INSERT_ID()
	  	</selectKey>
	  	INSERT INTO report_submit(
			report_no,
			account_id,
			report_submit_createdate,
			report_submit_updatedate,
			report_submit_title,
			report_submit_content
		) VALUES (
			#{reportNo},
			#{accountId},
			NOW(),
			NOW(),
			#{reportSubmitTitle},
			#{reportSubmitContent}
		)
	</insert>
	<!-- 과제제출 정보 수정 -->
	<update id="updateReportSubmit">
		UPDATE report_submit
		SET
			report_submit_updatedate = NOW(),
			report_submit_title = #{reportSubmitTitle},
			report_submit_content = #{reportSubmitContent}
		WHERE report_submit_no = #{reportSubmitNo}
	</update>
</mapper>